function g(s,t=250){let e;return function(...n){e!==void 0&&clearTimeout(e),e=setTimeout(()=>s.apply(this,n),t)}}function p(s){return s.replace(/([$`"\\!|&;<>*?{}()])/g,"\\$1")}function h(s){return s.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}function c(s){return s=s.replace(/-([a-z])/g,(t,e)=>e.toUpperCase()),s.charAt(0).toLowerCase()+s.slice(1)}function o(s,t){return s.matches(t)?s:s.querySelector(t)}function u(s,t){let e=[];return s.matches(t)&&e.push(s),e.push(...Array.from(s.querySelectorAll(t))),e}var l=class{element;initialized=!1;DOM={};controllerName;controllerKebabName;constructor(t){this.element=t,this.controllerName=c(this.getControllerName()),this.controllerKebabName=h(this.controllerName),this.init()}init(){this.initialized||(this.connect(),this.setupActions(),this.initialized=!0)}initializeDOM(t){return this.DOM={el:this.element,...t},t}getDOMElement(t){return Array.isArray(this.DOM[t])?this.DOM[t][0]:this.DOM[t]}getDOMArray(t){let e=this.DOM[t];return e?Array.isArray(e)?e:[e]:[]}getTarget(t,e){let n=e||this.element,r=`[data-${this.controllerKebabName}-target="${t}"]`;return o(n,r)}getTargets(t,e){let n=e||this.element;return u(n,`[data-${this.controllerKebabName}-target="${t}"]`)}getGlobalTarget(t){return document.querySelector(`[data-${this.controllerKebabName}-target="${t}"]`)}setupActions(){u(this.element,"[data-action]").forEach(e=>{let n=e.getAttribute("data-action");if(n){let[r,i]=n.split("->"),[a,E]=i.split("#");if(a===this.controllerKebabName){let d=this[E];typeof d=="function"&&e.addEventListener(r,m=>{let v=this.extractActionParams(e);m.params=v,d.call(this,m)})}}})}extractActionParams(t){let e={};for(let[n,r]of Object.entries(t.dataset))if(n.startsWith(this.controllerName)&&n.endsWith("Param")){let i=c(n.slice(this.controllerName.length,-5));e[i]=this.parseParamValue(r)}return e}parseParamValue(t){if(t==null||t.trim()==="")return"";let e=t.trim();if(/^(true|false)$/i.test(e))return e.toLowerCase()==="true";if(/^[+-]?\d+(\.\d+)?([eE][+-]?\d+)?$/.test(e)){let n=Number(e);if(!Number.isNaN(n)&&Number.isFinite(n))return n}if(/^(null|undefined)$/i.test(e))return e.toLowerCase()==="null"?null:void 0;if(/^[{[]/.test(e)||/^".*"$/.test(e))try{return JSON.parse(e)}catch{}return t}getValue(t,e){let n=`data-${this.controllerKebabName}-${t}-value`,r=e||this.element,i=o(r,`[${n}]`);return i&&i.getAttribute(n)||""}setValue(t,e,n){let r=`data-${this.controllerKebabName}-${t}-value`;(n||this.element).setAttribute(r,e)}hasValue(t,e){let n=`data-${this.controllerKebabName}-${t}-value`,r=e||this.element;return o(r,`[${n}]`)!==null}on(t,e){document.addEventListener(t,e)}dispatch(t,e={}){let n=new CustomEvent(t,{detail:e,bubbles:!0});document.dispatchEvent(n)}getControllerName(){return this.constructor.name.replace(/^_/,"").replace(/Controller$/,"")}};var f=class extends l{sendValue=null;connect(){this.initializeDOM({"send-code":this.getTargets("send-code")}),this._funcName=this.getValue("name")||null,this._initializeArgs(),this._listenForEvents()}_listenForEvents(){this.on("mode:changed",t=>{let n=t.detail.mode;console.log("mode:changed",n),this._updateAllFunctionsMode(n)}),this.on("address:changed",t=>{let n=t.detail.address;this._updateAllFunctionsAddress(n)})}_updateAllFunctionsMode(t){this.getTargets("mode").forEach(n=>{console.log("modeElement in function",n);let r=this.getValue("mode",n)===t;n.classList.toggle("u-inline",r),n.classList.toggle("u-hidden",!r),n.dataset.copyTarget=r&&this._funcName?`action-function-${this._funcName}`:""})}_updateAllFunctionsAddress(t){this.getTargets("address").forEach(n=>{n.textContent=t.trim()||"ADDRESS"})}_sanitizeArgsInput(t){let e=this.getValue("param",t)||"",n=t.value.trim();return e||console.warn("sanitizeArgsInput: param is missing in arg input dataset."),{paramName:e,paramValue:n}}_initializeArgs(){this.getTargets("param-input").forEach(t=>{let{paramName:e,paramValue:n}=this._sanitizeArgsInput(t);e&&this._pushArgsInDOM(e,n)})}_debouncedUpdateAllArgs=g((t,e)=>{t&&this._pushArgsInDOM(t,e)},50);_pushArgsInDOM(t,e){let n=p(e);this.getTargets("arg").filter(i=>this.getValue("arg",i)===t).forEach(i=>{i.textContent=n||""});let r=this.getTarget("function-link");if(r){if(!r.getAttribute("href")){console.warn("No href attribute found for function link");return}let a=new URL(r.href,window.location.origin);a.searchParams.set(t,e),r.href=a.toString()}}updateAllArgs(t){let e=t.target,{paramName:n,paramValue:r}=this._sanitizeArgsInput(e);n&&this._debouncedUpdateAllArgs(n,r)}updateAllFunctionsSend(t){let e=t.params?.send||!1;this.getDOMArray("send-code").forEach(n=>{n.textContent=e?this.getValue("send"):""})}};export{f as ActionFunctionController};
